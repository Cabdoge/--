\ProvidesPackage{elegantfix}[2025/08/23 v1.0 Patch lemma & corollary for ElegantBook]

\RequirePackage{etoolbox}
\RequirePackage{kvoptions}
\SetupKeyvalOptions{family=EBPATCH, prefix=EBPATCH@, setkeys=\kvsetkeys}

% 可选项：紫色自定义（RGB 三元组），默认使用 147,112,219
\DeclareStringOption[147,112,219]{purpleRGB}
\ProcessKeyvalOptions*

% 需要类里已经定义的颜色与命令
\providecolor{structurecolor}{rgb}{0,0,0} % 若未加载类也能编过，但颜色不理想

% 定义紫色
\expandafter\definecolor\csname ebpatch@myPurple\endcsname{RGB}{\EBPATCH@purpleRGB}

% 兼容 cn/en 多语言标题名
\providecommand{\exercisename}{练习}
\providecommand{\proofname}{证明}
\providecommand{\lemmaname}{引理}
\providecommand{\corollaryname}{推论}

% —————————————————— 列表与 problemset/exercise 配置 ——————————————————
\RequirePackage{enumitem}
\RequirePackage{adforn}
\RequirePackage{xcolor}

% 重定 problemset：不再加入目录
\providecommand{\xchaptertitle}{\chaptername~\thechapter~}
\renewenvironment{problemset}[1][\xchaptertitle~\exercisename]{%
  \vspace*{10pt}%
  \begin{center}%
    \textcolor{structurecolor}{\Large\bfseries
      \adftripleflourishleft~#1~\adftripleflourishright}%
  \end{center}%
  \begin{enumerate}[label=\color{structurecolor}\arabic*.]%
}{%
  \end{enumerate}%
}

% enumerate 第二级样式
\setlist[enumerate,2]{label=(\arabic*), leftmargin=2em}

% exercise 改为按 section 编号
\makeatletter
\@removefromreset{exer}{chapter}
\@addtoreset{exer}{section}
\renewcommand{\theexer}{\thesection.\arabic{exer}}
\makeatother

% exerciseline 分隔标题
\newcommand{\xsubsectiontitle}{\thesubsection~}
\newenvironment{exerciseline}[1][\xsubsectiontitle~\exercisename]{%
  \vspace*{10pt}%
  \begin{center}%
    \textcolor{structurecolor}{\Large\bfseries
      \adftripleflourishleft~#1~\adftripleflourishright}%
  \end{center}%
}{}

% proof 末尾添加方块
\renewenvironment{proof}{%
  \par\noindent\textbf{\color{second}\small\proofname}%
  \color{black!90}\cfs%
}{%
  \hfill$\Box$\quad\par%
}





%%%%%%think环境定义%%%%%%
%think颜色定义
\definecolor{thinkcolor}{RGB}{244,105,102}
% 任选其一：图标定义
\usepackage{fontawesome5}                    % 方案 1：推荐
\newcommand{\ThinkIcon}{\scriptsize\color{cyan!90}\faBook}
\newcounter{think}[section]
\setcounter{think}{0}
\renewcommand{\thethink}{\thesection.\arabic{think}}
% 其余与上面相同
\newenvironment{think}[1][]{
  \refstepcounter{think}
  \par\noindent\makebox[-3pt][r]{\ThinkIcon\quad}
  \textbf{\color{thinkcolor}思考 \thethink\ #1 }\rmfamily\ %
  \kaishu
  }{
  \par\ignorespacesafterend}
%对应的无编号环境
\newenvironment{think*}[1][]{
  \par\noindent\makebox[-3pt][r]{\ThinkIcon\quad}
  \textbf{\textcolor{thinkcolor}{思考\ #1}}\rmfamily\ %
  \kaishu
  }{
  \par\ignorespacesafterend}

%目录显示到subsection
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}